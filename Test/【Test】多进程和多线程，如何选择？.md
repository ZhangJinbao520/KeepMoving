<!-- @title: 【Test】多进程和多线程，如何选择？ -->
<!-- @date: 2021-12-27 11:15:04 -->
<!-- @author: Zhang Jinbao -->

[TOC]

## 何为进程，何为线程？

进程是<font color="red">资源分配</font>的最小单位，线程是<font color="red"> CPU 调度</font>的最小单位。

### 进程

一个进程对应一个 PID（Process ID）。



### 线程

线程之间<font color="purple">使用相同的地址空间</font>，共享大部分数据。

创建一个线程所花费的空间远远小于创建一个进程所花费的空间，并且线程间切换所需时间也远远小于进程间切换所需时间。

> 💬说明：据不完全统计，一个进程开销大约是一个线程开销的 30 倍左右。



## 进程、线程，孰优孰劣？

|   维度    |          进程          |          线程          |   总结   |
| :-------: | :--------------------: | :--------------------: | :------: |
| 数据共享  |  复杂（需要借助 IPC）  |  简单（共享进程数据）  | 线程占优 |
| 数据同步  |      简单（独立）      |  复杂（共享进程数据）  | 进程占优 |
|    CPU    |      CPU 利用率低      |      CPU 利用率高      | 线程占优 |
|   内存    |       内存占用多       |       内存占用少       | 线程占优 |
|   切换    |        切换复杂        |        切换简单        | 线程占优 |
| 创建/销毁 |         速率慢         |         速率快         | 线程占优 |
|   编程    |          简单          |          复杂          | 进程占优 |
|   调试    |          简单          |          复杂          | 进程占优 |
|  可靠性   | 高（进程间不相互影响） | 低（线程挂导致进程挂） | 进程占优 |
|  分布式   | 适用于多核、多机分布式 |    适用于多核分布式    | 进程占优 |
| 可扩展性  |          简单          |          复杂          | 进程占优 |



## 什么场景建议用什么？

- 优选线程
  - 需要频繁创建/销毁的，如：Web 服务器
  - 需要进行大量计算的，如：图像处理、算法处理
  - 可能要扩展到多核分布的
  - …
- 优选进程
  - 可能要扩展到多机分布的
  - …

> 💬说明</font>：在实际应用中，都是采取“进程+线程”的方式。